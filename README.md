# bopomofo34

大千注音排列到34鍵位，適合40%鍵盤的注音輸入解決方案

## 📋 專案簡介

這是一個專為 40% 鍵盤（34 鍵位）設計的注音輸入法腳本，使用 AutoHotkey 實現。將標準大千注音鍵盤布局重新映射到小型鍵盤上，讓使用緊湊型鍵盤的用戶也能享受流暢的中文注音輸入體驗。

## ✨ 功能特點

- 🎯 **34鍵位適配**: 專為 40% 鍵盤量身定制，充分利用有限的按鍵
- 📝 **完整注音支持**: 支援所有大千注音符號（聲母、韻母、介音、聲調）
- 🔄 **智慧狀態機**: 內建注音組合狀態機，確保正確的注音輸入順序
- 💡 **即時顯示**: 提供注音狀態與輸入緩衝區的即時顯示
- 🎛️ **一鍵切換**: 支持中英文輸入模式快速切換
- ⚡ **輕量高效**: 使用 AutoHotkey 實現，資源佔用極低

## 🛠️ 系統需求

- Windows 作業系統
- [AutoHotkey v1.1](https://www.autohotkey.com/) 或更新版本
- 支援中文輸入法的系統環境

## 📦 安裝與使用

### 1. 安裝 AutoHotkey
```bash
# 請先下載並安裝 AutoHotkey
# 官方網站: https://www.autohotkey.com/
```

### 2. 下載腳本
```bash
git clone https://github.com/yourusername/bopomofo34.git
cd bopomofo34
```

### 3. 執行腳本
```bash
# 雙擊執行 bopomofo34.ahk
# 或使用命令列執行
autohotkey.exe bopomofo34.ahk
```

### 4. 開機自動啟動（可選）
將 `bopomofo34.ahk` 放入 Windows 啟動資料夾：
```
%APPDATA%\Microsoft\Windows\Start Menu\Programs\Startup\
```

## 🎮 使用方法

1. **啟動腳本**: 執行 `bopomofo34.ahk`
2. **切換模式**: 在支援中文輸入的應用程式中使用
3. **注音輸入**: 按照重新映射的鍵位輸入注音符號
4. **狀態顯示**: 腳本會顯示當前注音狀態和輸入緩衝區

## 🗝️ 按鍵映射

本腳本將標準大千注音布局重新映射到 34 鍵位鍵盤，詳細的按鍵映射請參考源碼中的定義。

### 主要按鍵區域
- **聲母區**: 對應原大千注音的聲母位置
- **韻母區**: 對應原大千注音的韻母位置
- **介音區**: 對應原大千注音的介音位置
- **聲調區**: 對應原大千注音的四聲標記

## 📍 完整按鍵映射表

### 字母鍵映射

| 按鍵 | 注音符號 | Unicode | 說明 |
|:----:|:--------:|:-------:|:-----|
| A | ㄇ | 0x3107 | 聲母 |
| B | ㄖ | 0x3116 | 聲母 |
| C | ㄏ | 0x310F | 聲母 |
| D | ㄎ | 0x310E | 聲母 |
| **E** | **ㄍ/ˇ** | **0x310D/0x02C7** | **共用鍵：聲母ㄍ 或 三聲** |
| F | ㄑ | 0x3111 | 聲母 |
| G | ㄕ | 0x3115 | 聲母 |
| H | ㄘ | 0x3118 | 聲母 |
| I | ㄛ | 0x311B | 韻母 |
| J | ㄨ | 0x3128 | 介音 |
| K | ㄜ | 0x311C | 韻母 |
| L | ㄠ | 0x3120 | 韻母 |
| M | ㄩ | 0x3129 | 介音 |
| N | ㄙ | 0x3119 | 聲母 |
| **O** | **ㄉ/ㄟ** | **0x3109/0x311F** | **共用鍵：聲母ㄉ 或 韻母ㄟ** |
| P | ㄣ | 0x3123 | 韻母 |
| Q | ㄆ | 0x3106 | 聲母 |
| **R** | **ㄐ/ˋ** | **0x3110/0x02CB** | **共用鍵：聲母ㄐ 或 四聲** |
| S | ㄋ | 0x310B | 聲母 |
| T | ㄔ | 0x3114 | 聲母 |
| **U** | **ㄧ/˙** | **0x3127/0x02D9** | **共用鍵：介音ㄧ 或 輕聲** |
| V | ㄒ | 0x3112 | 聲母 |
| W | ㄊ | 0x310A | 聲母 |
| X | ㄌ | 0x310C | 聲母 |
| **Y** | **ㄗ/ˊ** | **0x3117/0x02CA** | **共用鍵：聲母ㄗ 或 二聲** |
| Z | ㄈ | 0x3108 | 聲母 |

### 符號鍵映射

| 按鍵 | 注音符號 | Unicode | 說明 |
|:----:|:--------:|:-------:|:-----|
| ; | ㄤ | 0x3124 | 韻母 |
| . | ㄡ | 0x3121 | 韻母 |
| **,** | **ㄅ/ㄝ** | **0x3105/0x311D** | **共用鍵：聲母ㄅ 或 韻母ㄝ** |
| **/** | **ㄓ/ㄥ** | **0x3113/0x3125** | **共用鍵：聲母ㄓ 或 韻母ㄥ** |
| [ | ㄚ | 0x311A | 韻母（專用） |
| ] | ㄞ | 0x311E | 韻母（專用） |
| ' | ㄢ | 0x3122 | 韻母（專用） |
| " | ㄦ | 0x3126 | 韻母（專用，Shift+') |
| - | ㄦ | 0x3126 | 韻母（備用） |
| Space | (一聲) | - | 無聲調 |

### 數字鍵映射（備用）

| 按鍵 | 注音符號 | 說明 |
|:----:|:--------:|:-----|
| 1 | ㄅ | 聲母備用 |
| 2 | ㄉ | 聲母備用 |
| 3 | ˇ | 三聲備用 |
| 4 | ˋ | 四聲備用 |
| 5 | ㄓ | 聲母備用 |
| 6 | ˊ | 二聲備用 |
| 7 | ˙ | 輕聲備用 |
| 8 | ㄚ | 韻母備用 |
| 9 | ㄞ | 韻母備用 |
| 0 | ㄢ | 韻母備用 |

## 🔧 共用鍵判斷機制

### 狀態機邏輯
腳本使用有限狀態機（FSM）來判斷共用鍵的功能：

```
狀態轉換：INIT → CONSONANT → MEDIAL → VOWEL → TONE → INIT
          初始    聲母       介音     韻母     聲調    重置
```

### 共用鍵判斷規則

#### 1. **E 鍵 (ㄍ/ˇ)**
```autohotkey
if (ZhuyinState = "INIT") {
    輸出: ㄍ (聲母)
} else {
    輸出: ˇ (三聲)
}
```

#### 2. **R 鍵 (ㄐ/ˋ)**
```autohotkey
if (ZhuyinState = "INIT") {
    輸出: ㄐ (聲母)
} else {
    輸出: ˋ (四聲)
}
```

#### 3. **Y 鍵 (ㄗ/ˊ)**
```autohotkey
if (ZhuyinState = "INIT") {
    輸出: ㄗ (聲母)
} else {
    輸出: ˊ (二聲)
}
```

#### 4. **U 鍵 (ㄧ/˙)**
```autohotkey
if (ZhuyinState = "INIT" || ZhuyinState = "CONSONANT") {
    輸出: ㄧ (介音)
} else {
    輸出: ˙ (輕聲)
}
```

#### 5. **O 鍵 (ㄉ/ㄟ)**
```autohotkey
if (ZhuyinState = "INIT") {
    輸出: ㄉ (聲母)
} else {
    輸出: ㄟ (韻母)
}
```

#### 6. **逗號鍵 (ㄅ/ㄝ)**
```autohotkey
if (ZhuyinState = "INIT") {
    輸出: ㄅ (聲母)
} else {
    輸出: ㄝ (韻母)
}
```

#### 7. **斜線鍵 (ㄓ/ㄥ)**
```autohotkey
if (ZhuyinState = "INIT") {
    輸出: ㄓ (聲母)
} else {
    輸出: ㄥ (韻母)
}
```

## 🎯 輸入範例

### 範例 1: 輸入「中」(ㄓㄨㄥ)
1. 按 `/` → 狀態：INIT，輸出 ㄓ，變為 CONSONANT
2. 按 `J` → 狀態：CONSONANT，輸出 ㄨ，變為 MEDIAL  
3. 按 `/` → 狀態：MEDIAL，輸出 ㄥ，變為 VOWEL
4. 按 `Space` → 完成輸入，重置狀態

### 範例 2: 輸入「好」(ㄏㄠˇ)
1. 按 `C` → 狀態：INIT，輸出 ㄏ，變為 CONSONANT
2. 按 `L` → 狀態：CONSONANT，輸出 ㄠ，變為 VOWEL
3. 按 `E` → 狀態：VOWEL，輸出 ˇ，變為 TONE
4. 按 `Space` → 完成輸入，重置狀態

### 範例 3: 輸入「一」(ㄧ)
1. 按 `U` → 狀態：INIT，輸出 ㄧ，變為 MEDIAL
2. 按 `Space` → 完成輸入，重置狀態

## ⚠️ 注意事項

1. **優先順序**：當按鍵有兩種功能時，優先判斷是否為聲母（第一個字元）
2. **狀態重置**：每次輸入完成後，狀態機自動重置到 INIT
3. **錯誤處理**：按 `Esc` 或 `Tab` 可手動重置狀態
4. **回退功能**：按 `BackSpace` 可回到上一個狀態

### 聲調共用
ˇ (三聲) | ㄍ 共用 E
ˋ (四聲) | ㄐ 共用 R
ˊ (二聲) | ㄗ 共用 Y
˙ (輕聲) | ㄧ 共用 U

### 聲母共用
ㄅ | ㄝ 共用 ,
ㄉ | ㄟ 共用 O
ㄓ | ㄥ 共用 /

### 韻母共用
ㄚ 指定到 [
ㄞ 指定到 ]
ㄢ 指定到 '
ㄦ 指定到 " (shift+')

### 共用原則
遵守 聲母-介音-韻母-聲調 原則
* 第一個字一定不是聲調 => 聲調與聲母出現時一定是聲母, ˙ (輕聲) 與 ㄧ還多加聲母規則
* ㄝ, ㄟ, ㄥ 都不會是第一個字. 有例外, 但是沒打過 (誒 (ㄝˋ), 欸 (ㄟˋ))
* 依照教育部《國語辭典簡編本‧字詞頻統計》整理的韻母使用頻率

| 韻母 | 出現次數 | 佔比    |
|:----:|--------:|--------:|
| ㄞ   | 76,203  | 3.843%  |
| ㄢ   | 75,572  | 3.811%  |
| ㄚ   | 70,954  | 3.578%  |
| ㄦ   | 10,677  | 0.539%  |

* 維持由左到右的規則

## 🔧 自訂設定

您可以根據個人喜好修改 `bopomofo34.ahk` 中的按鍵映射：

```autohotkey
; 範例：修改特定按鍵映射
$a::
if (CheckZhuyinMode()) {
    ProcessZhuyinInput(Chr(0x3107))  ; ㄇ
    send a
} else {
    Send a
}
return
```

## 📊 狀態機說明

腳本內建智慧狀態機，支援以下注音輸入狀態：
- `INIT`: 初始狀態
- `CONSONANT`: 已輸入聲母
- `MEDIAL`: 已輸入介音
- `VOWEL`: 已輸入韻母
- `TONE`: 已輸入聲調
- 以及各種組合狀態

## 🤝 貢獻

歡迎提交 Issue 和 Pull Request 來改善這個專案！

### 貢獻方式
1. Fork 這個專案
2. 建立您的功能分支 (`git checkout -b feature/AmazingFeature`)
3. 提交您的變更 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 開啟一個 Pull Request

## 📄 授權條款

本專案採用 MIT 授權條款 - 詳見 [LICENSE](LICENSE) 檔案

## 🙏 致謝

- 感謝 AutoHotkey 社群提供的強大腳本平台
- 感謝所有使用者的回饋與建議

## 📞 聯絡方式

如有問題或建議，請透過以下方式聯絡：
- 提交 [GitHub Issue](https://github.com/yourusername/bopomofo34/issues)
- 或發送郵件至 your.email@example.com

---

> 讓小鍵盤也能擁有完整的中文輸入體驗！ 🚀


